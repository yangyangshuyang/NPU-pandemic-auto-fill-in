# NPU-pandemic-auto-fill-in

西北工业大学疫情自动填报Python脚本

## 免责声明

**本脚本专为懒人准备，不代表校方观点。若填报失败、填报错误、被后台识别等，开发者不负任何责任。使用此脚本则表示你已阅读并同意以上免责声明。**

## 脚本说明

该脚本在每天5:34和9:34（北京时间）自动填报，可能会稍晚数分钟甚至一个多小时。填报两次是为了确保填报成功。你可以修改yml文件里的cron表达式来修改执行时间。

该脚本自动填报的信息如下：

- 当前所在位置：（重复上次填报信息）
- 今天的体温范围：37.3度以下
- 您有无疑似症状：无
- 西安市一码通状态：绿码
- 是否经停中高风险地区/接触中高风险地区人员等：否
- 其他情况说明：（空）

疫情填报问题可能更新，总之除了所在位置，其他信息都填正常的选项。

关于“当前所在位置”：脚本填报的位置为**上一次填写的位置**，所以使用此脚本前请保证手动填过一次。**如因放假或返校等原因更换居住地，请手动填报一次，并更新居住位置，以后脚本会自动填报更新后的位置。**

注意：若仓库60天无活动，GitHub将自动停止Action。停止前7天GitHub将向你的注册邮箱发送邮件，前往邮件按提示操作即可恢复。

## 食用方法

**再次提醒**：使用此脚本前请手动填报一次；更换居住地请手动更新一次信息。

1. **Fork该仓库（点右上角从左到右第二个按钮）**

   ~~当然给个三连也行~~

1. **进入Fork的仓库，点Settings>Secrets，添加以下秘密信息。**

   | 名称（大写） | 说明                    | 示例           |
   | ------------ | ----------------------- | -------------- |
   | STUDENTID    | 你的学号                | 2021000001    |
   | PASSWORD     | 你翱翔门户的密码        | 123456         |
   | WEBHOOK      | 钉钉Webhook地址（可选） | https://...... |

   ![教程](images/directions1.jpg)

   旧版本需要姓名，现在已不需要，因此图中的NAME字段无需添加。

   其中WEBHOOK用于向钉钉群聊发送填报通知，如需要使用此功能，可访问[官方文档](https://open.dingtalk.com/document/group/custom-robot-access)配置。安全关键词填写“疫情自动填报”。若填“填报失败”则只接收填报失败的通知。不需要接收填报通知，则无需创建该字段。

   所有信息均在GitHub加密保存，所有人（包括仓库所有者）无法直接看到，仅在执行脚本时作为参数传入，请放心填写。

2. **进入Actions页面，启用Workflow。**

   ![教程](images/directions2.jpg)

## 注意事项

1. 如果你更改了密码，请务必更新Settings>Secrets里的PASSWORD为你修改后的密码，否则会填报失败。
2. 如果你被辅导员请去喝茶，请不要提及此脚本。否则若学生用脚本自动填报一事被发现，会威胁广大同胞的人身安全。
3. 如因放假或返校等原因更换居住地，请手动填报一次，并更新居住位置，以后脚本会自动填报更新后的位置。

## 更新日志

**2022年8月8日**

[新增] 添加智能位置填报功能，可自动填报上一次的位置信息，而不总是“在学校”。

[新增] 填报失败时让Python程序异常退出，以便GitHub Actions处理。

[新增] 新增调试模式，可使用本地配置。

[修改] 现不需要姓名也可填报。

[修改] 修改填报字段和Header。

[修复] 修复翱翔门户登录逻辑，现可正常登录。

**2022年4月21日**

疫情填报url更改，并全线换成HTTPS。

**2022年4月17日**

添加了图片引导，修正一些小错误。

**2021年12月23日**

疫情填报系统更新，部分字段调整，并加上了签名校验。填报时如果不带签名，则会发生错误，错误码为-2，错误信息为“系统已记录您的非正常操作，所有绕过系统页面正常操作以外的的行为，都将视为网络攻击行为！”。目前已紧急修复，合并一下分支即可。

## 彩蛋

下面代码是疫情填报页面的一段js代码。中  门  对  狙

```javascript
// jrsb_xs.jsp:1844-1849
	});
}else if(data.state!=null&&data.state=='-3'){
		layer.msg('完了，不能自动填报了，芭比q了~',{time:3000},function(){
			window.location.href="jrsb_xs.jsp";
	});
}else{
```

## 开发者

Jelly Black

QQ:1574854804

如不能填报了烦请提issues或联系开发者，以便及时更新。更新后请手动合并分支。